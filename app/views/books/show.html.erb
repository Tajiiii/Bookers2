<body>
  <div class="container">
    <p id="notice">
      <%= notice %>
    </p>
    <div class="row">
      
      <div class="col-xs-3">
        <h2>User info</h2>
        <img class="attachment user profile_image fallback">
        <table class="table">
          <tbody>
            <tr><%= attachment_image_tag @book_show.user, :profile_image, :fill, 60, 60, format: 'jpeg', fallback: "no_image.jpg" %></tr> 
            <tr>
              <th>name</th>
              <th><%= @book_show.user.name %></th>
            </tr>
            <tr>
              <th>introduction</th>
              <th><%= @book_show.user.introduction %></th>
            </tr>
          </tbody>
        </table>

        <div class="row">
          <%= link_to edit_user_path(current_user) do %><i class="col-xs-12 btn btn-default glyphicon glyphicon-wrench"></i><% end %>
        </div>

        <div class="row">
          <h2>New book</h2>
          <%= form_for(@book) do |f| %>
            <div class="field row">
              <label class="book_title">Title</label>
              <%= f.text_field :title, class: "col-xs-12" %>
            </div>

            <div class="field row">
              <label class="book_opinion">Opinion</label>
              <%= f.text_area :body, class: "col-xs-12" %>
            </div>
            <br>

            <div class="actions row">
              <%= f.submit 'Create Book', class: "btn btn-primary col-xs-12" %>
            </div>
          <% end %>
        </div>

      </div>

      <div class="col-xs-9">
        <h2>Book detail</h2>

        <table class="table">
          <thead>
            <tr>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
            </tr>
          </thead>

          <tbody>

              <tr>
                <td>
                  <%= link_to user_path(@book_show.user) do %>
                    <%= attachment_image_tag @book_show.user, :profile_image, size: '40x40', fallback: "no_image.jpg" %><br>
                    <%= @book_show.user.name %>
                  <% end %>
                </td>
                <td><%= @book_show.title %></td>
                <td><%= @book_show.body %></td>
                <td><% if @book_show.favorited_by?(current_user) %>
                        <%= link_to book_favorites_path(@book_show), method: :delete do %>
                          <span class="glyphicon glyphicon-heart" aria-hidden="true"></span>
                          <%= @book_show.favorites.count %>
                        <% end %>
                      <% else %>
                        <%= link_to book_favorites_path(@book_show), method: :post do %>
                          <span class="glyphicon glyphicon-heart-empty" aria-hidden="true"></span>
                          <%= @book_show.favorites.count %>
                        <% end %>
                    <% end %></td>
                <td><p>コメント数:<%= @book_show.book_comments.count %></p></td>
                  <td>
                    <% if @book_show.user == current_user %>
                      <%= link_to 'Edit', edit_book_path, class: "btn-sm btn-success" %>
                  <% end %>
                  </td>

                  <td>
                    <% if @book_show.user == current_user %>
                      <%= link_to 'Destroy', book_path, method: :delete, data: { confirm: '本当に消しますか?' }, class: "btn-sm btn-danger" %>
                    <% end %>
                  </td>
              </tr>

          </tbody>
        </table>

        <table>
          <% @book_show.book_comments.each do |book_comment| %>
            <tr>
            <td class="show-comment">
                <%= link_to user_path(book_comment.user), class: "user_#{book_comment.user.id}" do %>
                  <%= attachment_image_tag book_comment.user, :profile_image, fallback: "no_image.jpg", size: "50x50" %><br>
                  <%= book_comment.user.name %>
                <% end %>
            </td>
            <td class="comment-entry"><%= book_comment.comment %></td>
            <% if book_comment.user == current_user %>
              <td>
                <%= link_to "destroy", book_book_comment_path(book_comment.book, book_comment), method: :delete, class: "btn btn-danger pull-right" %>)
                  </td>
            <% end %>
          </tr>
          <% end %>

      <div class="comment-form">
        <%= form_for [@book_show, @book_comment] do |f| %>
          <%= f.text_area :comment, size:'90x5' %>
          <%= f.submit "送信", class: "btn-sm btn-primary" %>
        <% end %>
      </div>
      
  </div>

</body>